<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Kevin George by kgeok</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" sizes="60x60" href="https://kgeok.github.io/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="https://kgeok.github.io/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="https://kgeok.github.io/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="https://kgeok.github.io/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="https://kgeok.github.io/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="https://kgeok.github.io/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="https://kgeok.github.io/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://kgeok.github.io/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="https://kgeok.github.io/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/https://kgeok.github.io/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/https://kgeok.github.io/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://kgeok.github.io/favicon/favicon-16x16.png">
    <link rel="manifest" href="https://kgeok.github.io/favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#155799">
    <meta name="msapplication-TileImage" content="https://kgeok.github.io/favicon/ms-icon-144x144.png">
    <link rel="stylesheet" type="text/css" href="https://kgeok.github.io/stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="https://kgeok.github.io/stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="https://kgeok.github.io/stylesheets/github-light.css" media="screen">
    <style>

      * {

        box-sizing: initial;

      }

      .main-content h1, .main-content h2, .main-content h3, .main-content h4, .main-content h5, .main-content h6 {
        margin-top: 2rem;
        margin-bottom: 1rem;
        font-weight: normal;
        color: #FFFFFF;
    }

      .main-content {

        background-image: url("whiteboard-blur.jpg");
        background-position: center; 
        background-repeat: no-repeat; 
        background-size: cover;

      }

    </style>
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Kevin George</h1>
      <h2 class="project-tagline">
        <ul>
          <li><a href="https://kgeok.github.io">Home</a></li>
          <li><a href="https://kgeok.github.io/Projects">Projects</a></li>
          <li><a href="https://kgeok.github.io/WebApps">Web Apps</a></li>
          <li><a href="https://kgeok.github.io/PC">PC Builds</a></li>
          <li><a href="https://kgeok.github.io/photos">Photos</a></li>
          <li><a href="https://kgeok.github.io/about-me">About</a></li>
        </ul>
       </h2>
    </section>

    <section class="main-content">

<h3>
Journey into Odyssey
</h3>
<h4>Introduction<h4>
Inspired by map posters which people have used to pin and mark places to travel, I sought out to build a modern version of such a thing, seperate from a typical maps app to just fulfill this singular purpose. There was more that could have been done as well. 
<br/>
With the Journal feature, you can keep tabs of your overall pins in one convienient view. Pins can be captioned and colored to keep note of certain locations and destinations. 
<br/>
<h4>UI Management<h4>
Odyssey (Web):
<br/>
<br/>
While designing the UI was easy enough thanks to tinkering with the HTML and CSS.
<br/>
For the actual Pin itself, it’s based on a vectorized version of the pin image i previously made (SVG), we do this because not only does it provide a better resolution that tailors the device but that also means that we can avoid having to store another asset in the app and it allows us to provide different colors for the pins
<br/>
Every UI element was to be replaced with Widgets instead of DIVs Because the current User Interface already resembled Google’s Material Design, I also used the design language in the new code as well. Doing so made it much easier to implement the UI within a matter of fewer lines of code. 
<br/>
<br/>
From Web to App:
<br/>
<br/>
In the beginning Odyssey was mean't to run on the web, while being submitted as a PWA to the Microsoft Store. But of course that couldn’t just be the end of it. The idea was then to expand it to iOS, Android and macOS. Since the app was built using HTML, CSS and JavaScript, in theory it could have been really easy to port it to the other platforms and it was. But the problem was that it didn’t feel like a native app and that wasn’t okay. If I was going to continue on this path, the app had to be written natively from scratch. The question from there was the following: what set of tools and what language was I going to use to do the conversion. Naturally, an Electron/React Native app was the step in the right direction because it was widely adopted and that it used JavaScript, it was going to be easy to reuse my old code. But ultimately I ended up switching later to Flutter. This meant that the app needed to be retooled to use Dart instead of JavaScript. 
<br/>
<br/>
<img src= "webtoflutter.jpg" loading="lazy" height="500px" width= "700px"></img>
<br/>
<br/>
<img src= "flutter.png" loading="lazy" height="400px" width= "700px"></img>
<br/>
<br/>
The result was a such a drastic difference, buttons from before now live in a submenu and animations and transitions are smooth and responsive, this means that certain controls weren't needed anymore. 
<br/>
The HTML/JavaScript version will still exist as a Web App for those who want to use Odyssey on an unsupported platform.
<br/>
<h4>Memory Management</h4>
Odyssey (Web):
<br/>
<br/>
The biggest challenge was storing the data long term in the case of application close/restart. Service Workers could have done the trick but since the data was being saved locally instead of through a database, I turned to using cookies to saving data. Since cookies are stored as a single string, there had to be methods called to parse the string and send the values into the appropriate variables that then the functions can call 
<br/>
<code>
document.cookie = "PinCoor_" + MarkerCounter +"=" + e.latLng + "; expires=Fri, 31 Dec 9999 23:59:59 GMT; SameSite=None; Secure;";
<br/>
document.cookie = "PinCapt_" + MarkerCounter +"=" + caption + "; expires=Fri, 31 Dec 9999 23:59:59 GMT; SameSite=None; Secure;";
<br/>
document.cookie = "PinColor_" + MarkerCounter +"=" + PinColor + "; expires=Fri, 31 Dec 9999 23:59:59 GMT; SameSite=None; Secure;";
<br/>
document.cookie = "Counter=" + MarkerCounter + "; expires=Fri, 31 Dec 9999 23:59:59 GMT; SameSite=None; Secure;";  
<br/>
<br/>
for (i = 0; i < document.cookie.split("Coor").length-1; i++){ 
LoadState["Coor_" + i] = decodeURIComponent(document.cookie).split("PinCoor_" + i +"=").pop();
<br/>
LoadState["Coor_" + i] = LoadState["Coor_" + i].split(";").shift();
<br/>
LoadState["Capt_" + i] = decodeURIComponent(document.cookie).split("PinCapt_" + i +"=").pop();
<br/>
LoadState["Capt_" + i] = LoadState["Capt_" + i].split(";").shift();
<br/>
LoadState["Color_" + i] = decodeURIComponent(document.cookie).split("PinColor_" + i +"=").pop();
<br/>
LoadState["Color_" + i] = LoadState["Color_" + i].split(";").shift();
<br/>
LoadState["Coor_" + i] = LoadState["Coor_" + i].replace("(", "");
<br/>
LoadState["Coor_" + i] = LoadState["Coor_" + i].replace(")", "");
<br/>
CurrCorrX = LoadState["Coor_" + i].split(",").shift();
<br/>
CurrCorrY = LoadState["Coor_" + i].split(", ").pop();
<br/>
placeMarker(map, { lat: parseFloat(CurrCorrX, 10), lng: parseFloat(CurrCorrY, 10) }, LoadState["Capt_" + i], LoadState["Color_" + i]);                                                 
<br/>
</code>
<br/>
Later version of the Web App switched to a localStorage model instead of Cookies for better dependability.
<br/>
<br/>
Odyssey (App):
<br/>
<br/>
Because Flutter and Dart didn't support these HTML/JavaScript properties for the native app, all storage and data was stored as a SQLite database that lived in the OS's App Documents. 
<br/>
The memory model of Odyssey works as the following:
<br/>
<img src= "memtypes.jpg" loading="lazy" height="500px" width= "600px"></img>
<br/>
<br/>
When a session is restored the contents of OdysseyDB.db are loaded into Pins[] to be used for the session memory, after it’s loaded, a minimized version of appendMarker() runs because we already have the contents from reversegeocoder() already loaded, we don’t want to waste time and resources trying to reverse geocode for something we already have.
<br/>
Pins are stored in a separate list that ideally only the Google Maps Controller should be using. In the case we need to “Delete Last Pin” or “Clear all Pins” we touch that list then.
<br/>
<br/>
<h4>Location Management</h4>
When running “Pin from Address” we actually only need to do a standard geocode to get the LatLng and just do an appendMarker() we also have to do another reverse geocode because sometimes a user only give a partial address and we rely on full address to be stored in OdysseyDB.db
<br/>
“Pin My Location” and zooming into location first ask the OS for it’s physical location, we rely on full accurate location because we don’t want to zoom or pin somewhere the user isn’t. If we don’t see that location is available right there, we might have to ask for permission to get that information
<br/>
<code>
_permissionGranted = await location.hasPermission();
<br/>
if (_permissionGranted == prefix.PermissionStatus.denied) {
<br/>
_permissionGranted = await location.requestPermission();
<br/>
if (_permissionGranted != prefix.PermissionStatus.granted) {
<br/>
simpleDialog(context, "No Location", "Unable to Determine Location",
<br/>
"Check your Location or Privacy Settings", "error");
<br/>
return;
<br/>
}
<br/>
if (_permissionGranted == prefix.PermissionStatus.deniedForever) {
<br/>
simpleDialog(context, "No Location", "Unable to Determine Location",
<br/>
"Check your Location or Privacy Settings", "error");
<br/>
return;
<br/>
}
<br/>
}
<br/>  
</code>
<br/>
<br/>
<h4>Journal Management</h4>
I think that this was the toughest aspect of Odyssey to work on aside from DB appending. The logical decision around this was to combine this with appendMarker() so that once the pin was created, reverse geocoding was done then after but for some reason appending on the Journal’s entry list attempts before the session’s PinData list has a chance to populate.
<br/>
  <h4>Pin Shapes</h4>
<br/>
In the original release of Odyssey there was only one pin shape: circle.
<br/>
Starting with Version 1.1, there are four additional shapes, diamond, star, heart and square.
<br/>
Odyssey uses SVG based vectors to reduce the reliance on file-based assets and to have the pin's resolution scale up.
<br/>
Using the new shapeHandler() function that contains all the SVG codes for all five shapes, we can have a simple variable and a set of switch cases to toggle between which SVG code is being called in the bitmapDescriptorFromSvg() function.
<br/> 
This function is called whenever a new pin is being appended whether by tapping the map or on restoring the state from OdysseyDB.db
<br/>
  <h4>SQLite DB Update</h4>
<br/>
The sqlite Flutter library features the ability to do version updates to an existing database. Taking advantage of this feature allowed Version 1.1 updates and future foundational updates to OdysseyDB.db. 
<br/>
On detection that a current database's version number does not match the one specified, a custom function is called, and the version number is incremented.
<br/> 
When the function is called, a set of SQL queries to insert the missing columns and append the missing values is done to catch the current database up to date.
<br/>
<code>
  void _upgradeDB(Database db, int oldVersion, int newVersion) async {
<br/>
    //This is for upgrading from 1.0 to 1.1 and future updates
<br/>
    if (oldVersion < newVersion) {
<br/>
    ...
<br/>
    }
<br/>
   }
<br/>
</code>
<br/>
In the future, we would need to create distinctions and comparisons between version numbers to see what columns exist and what doesn't to avoid an SQL query execution error.
<br/>
<br/>
Odyssey is available in the App Store, Google Play Store and on the Web, the Native app is free for all users.
<br/>
<footer class="site-footer"></footer>
</section>
</body>
</html>
